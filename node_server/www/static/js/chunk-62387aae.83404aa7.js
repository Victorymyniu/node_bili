(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62387aae"],{"0a49":function(t,e,i){var o=i("9b43"),a=i("626a"),s=i("4bf8"),c=i("9def"),n=i("cd1c");t.exports=function(t,e){var i=1==t,r=2==t,l=3==t,p=4==t,u=6==t,m=5==t||u,d=e||n;return function(e,n,f){for(var g,v,h=s(e),b=a(h),w=o(n,f,3),_=c(b.length),P=0,C=i?d(e,_):r?d(e,0):void 0;_>P;P++)if((m||P in b)&&(g=b[P],v=w(g,P,h),t))if(i)C[P]=v;else if(v)switch(t){case 3:return!0;case 5:return g;case 6:return P;case 2:C.push(g)}else if(p)return!1;return u?-1:l||p?p:C}}},"13c0":function(t,e,i){},"27cb":function(t,e,i){"use strict";var o=i("13c0"),a=i.n(o);a.a},3446:function(t,e,i){"use strict";var o=i("6b5d"),a=i.n(o);a.a},4042:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[t._m(0),t._v(" "),i("Hr"),t._v(" "),i("div",{staticClass:"topic-condition"},[i("el-form",{ref:"topicForm",staticClass:"demo-form-inline",attrs:{inline:!0,"label-width":"100px","label-position":"right",model:t.topicInfo}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"Topic名称：",prop:"topicName"}},[i("el-input",{attrs:{placeholder:"请输入Topic名称"},model:{value:t.topicInfo.topicName,callback:function(e){t.$set(t.topicInfo,"topicName",e)},expression:"topicInfo.topicName"}})],1)],1),t._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"分类标签：",prop:"topicFlag"}},[i("el-input",{attrs:{placeholder:"请输入分类标签"},model:{value:t.topicInfo.topicFlag,callback:function(e){t.$set(t.topicInfo,"topicFlag",e)},expression:"topicInfo.topicFlag"}})],1)],1),t._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"状态：",prop:"topicStatus"}},[i("el-select",{attrs:{placeholder:"全部"},model:{value:t.topicInfo.topicStatus,callback:function(e){t.$set(t.topicInfo,"topicStatus",e)},expression:"topicInfo.topicStatus"}},t._l(t.statusOptions,(function(t,e){return i("el-option",{key:t+e,attrs:{label:t,value:e}})})),1)],1)],1)],1),t._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"所属项目：",prop:"topicProjectId"}},[i("el-select",{attrs:{placeholder:"全部"},model:{value:t.topicInfo.topicProjectId,callback:function(e){t.$set(t.topicInfo,"topicProjectId",e)},expression:"topicInfo.topicProjectId"}},t._l(t.userProjectSelects,(function(t,e){return i("el-option",{key:t+e,attrs:{label:t.projectCode,value:t.id}})})),1)],1)],1),t._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订阅项目：",prop:"grantProjectId"}},[i("el-select",{attrs:{placeholder:"全部"},model:{value:t.topicInfo.grantProjectId,callback:function(e){t.$set(t.topicInfo,"grantProjectId",e)},expression:"topicInfo.grantProjectId"}},t._l(t.grantProjectOptions,(function(t,e){return i("el-option",{key:t+e,attrs:{label:t.projectCode,value:t.id}})})),1)],1)],1),t._v(" "),i("el-form-item",{staticClass:"menu-group"},[i("el-button",{attrs:{type:"primary"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.resetForm("topicForm")}}},[t._v("重置")])],1)],1)],1)],1),t._v(" "),i("div",{staticClass:"new_topic"},[i("el-button",{attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("\n      +新建Topic\n    ")]),t._v(" "),i("div",{staticClass:"topic-count"},[i("b",[t._v("Topic数量:")]),i("span",[t._v("待审批 "+t._s(t.topicStatistics.pendingNum))]),t._v(" "),i("b",[t._v("订阅量：")]),i("span",[t._v("共计 "+t._s(t.topicStatistics.subscribeNum))])])],1),t._v(" "),i("div",{staticClass:"topic-table"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":"","header-cell-style":{background:"#f7f7f7"},"row-class-name":t.tableRowClassName}},[i("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"topicName",label:"Topic名称",align:"center",sortable:""}}),t._v(" "),i("el-table-column",{attrs:{prop:"projectName",label:"所属项目",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{prop:"topicFlag",label:"分类标签",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{prop:"createUser",label:"创建者",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{prop:"aclProjectNum",label:"订阅量",width:"80",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{prop:"topicStatus",label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",{style:"color:"+t.statusStyle[o.topicStatus]+";font-size: 12px;"},[t._v("● "+t._s(t.statusOptions[o.topicStatus]))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"updateTime",label:"最近更新",width:"160",align:"center",sortable:""}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"240","class-name":"operation"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",{staticClass:"view",on:{click:function(e){return t.handleView(o)}}},[t._v("查看")]),t._v(" "),6===o.topicStatus?i("div",{staticClass:"option-type"},[i("span",{on:{click:function(e){return t.handleRecover(o)}}},[t._v("恢复")])]):i("div",{staticClass:"option-type"},[1!==o.topicStatus&&2!==o.topicStatus&&6!==o.topicStatus?i("div",{staticClass:"option-type"},[i("span",{on:{click:function(e){return t.handleEdit(o)}}},[t._v("编辑")]),t._v(" "),i("span",{on:{click:function(e){return t.handleDelete(o.id)}}},[t._v("删除")])]):t._e(),t._v(" "),4===o.topicStatus||5===o.topicStatus?i("span",{on:{click:function(e){return t.reloadTopic(o.id)}}},[t._v("重载")]):t._e(),t._v(" "),i("router-link",{attrs:{to:{path:"/subscribe-manage",query:{topicName:o.topicName}}}},[4===o.topicStatus?i("span",{staticClass:"isNull"},[t._v("订阅管理")]):t._e()])],1)]}}])})],1)],1),t._v(" "),i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.topicInfo.page,limit:t.topicInfo.limit},on:{"update:page":function(e){return t.$set(t.topicInfo,"page",e)},"update:limit":function(e){return t.$set(t.topicInfo,"limit",e)},pagination:t.getTopicList}}),t._v(" "),i("topic-detail",{ref:"newForm",attrs:{"new-page-visible":t.newPageVisible,title:t.title,"current-row":t.currentRow},on:{close:t.handleClose}}),t._v(" "),i("view-topic",{ref:"viewForm",attrs:{"view-page-visible":t.viewPageVisible,"current-row":t.currentRow},on:{close:t.handleClose}})],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-title"},[i("span",[t._v("我的Topic")])])}],s=i("abad"),c=i("333d"),n=i("77d2"),r=i("378e"),l={name:"TopicManage",components:{Pagination:c["a"],TopicDetail:n["default"],ViewTopic:r["default"]},data:function(){return{total:0,list:null,topicInfo:{page:1,limit:5,topicFlag:"",topicName:"",topicProjectId:null,grantProjectId:null,topicStatus:null},statusOptions:["草稿","待审批","已通过","已拒绝","已创建","创建失败","已删除"],statusStyle:["#000","#FFBB00","#32CD32","#1E90FF","#67c23a","#FF0000","#DCDCDC"],topicStatistics:{pendingNum:0,subscribeNum:0},userProjectSelects:[],grantProjectOptions:[],title:"",currentRow:null,listLoading:!1,newPageVisible:!1,viewPageVisible:!1}},created:function(){this.getTopicList(),this.getProjectList()},methods:{tableRowClassName:function(t){var e=t.row;t.rowIndex;return 6===e.topicStatus?"delete-row":""},getTopicList:function(){var t=this;this.listLoading=!0,Object(s["j"])(this.topicInfo).then((function(e){0===e.code?(t.getTopicStatistics(),t.list=e.datas.pageData,t.total=e.datas.count,t.listLoading=!1):t.$message({type:"error",message:e.msg})}))},getTopicStatistics:function(){var t=this;Object(s["h"])().then((function(e){if(0===e.code){var i=e.datas,o=i.wait,a=i.subscriberMun;t.topicStatistics={pendingNum:o,subscribeNum:a}}else t.$message({type:"error",message:e.msg})}))},getProjectList:function(){var t=this;Object(s["i"])().then((function(e){t.userProjectSelects=e.datas})),Object(s["f"])().then((function(e){t.grantProjectOptions=e.datas}))},handleFilter:function(){this.topicInfo.page=1,this.getTopicList()},handleCreate:function(){var t=this;this.newPageVisible=!0,this.title="新建Topic",this.$nextTick((function(){t.$refs.newForm.$refs["topicSubmitForm"].resetFields(),t.$refs.newForm.setDefaultChecked()}))},handleEdit:function(t){var e=this;this.newPageVisible=!0,this.title="编辑Topic",this.$nextTick((function(){e.$refs.newForm.$refs["topicSubmitForm"].resetFields(),e.currentRow=t,e.$refs.newForm.setDefaultChecked(),e.$refs.newForm.getRowData(t)}))},handleView:function(t){var e=this;this.viewPageVisible=!0,this.$nextTick((function(){e.$refs.viewForm.$refs["samplingForm"].resetFields(),e.currentRow=t,e.$refs.viewForm.getRowData(t)}))},handleClose:function(t){this.newPageVisible=!1,this.viewPageVisible=!1,t&&t.isSubmit&&this.getTopicList()},handleDelete:function(t){var e=this,i={id:t};this.$prompt("Topic删除后，所有数据将被清空无法恢复，且订项目无法消费，是否仍然确认删除？","请输入密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入密码",inputType:"password"}).then((function(t){var o=t.value,a={userPassword:o};Object(s["a"])(a).then((function(t){0===t.code?Object(s["b"])(i).then((function(t){0===t.code?(e.$message({showClose:!0,type:"success",message:t.msg}),e.getTopicList()):e.$message({showClose:!0,type:"error",message:t.msg})})):e.$message({showClose:!0,message:t.msg,type:"error"})}))})).catch((function(){e.$message({showClose:!0,type:"info",message:"取消输入"})}))},reloadTopic:function(t){var e=this,i={id:t};this.$prompt("Topic重载时，所有数据将被清空无法恢复，且影响订阅项目消费，是否仍然确认重载？","请输入密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入密码",inputType:"password"}).then((function(t){var o=t.value,a={userPassword:o};Object(s["a"])(a).then((function(t){0===t.code?Object(s["l"])(i).then((function(t){0===t.code?(e.$message({showClose:!0,type:"success",message:t.msg}),e.getTopicList()):e.$message({showClose:!0,type:"error",message:t.msg})})):e.$message({showClose:!0,message:t.msg,type:"error"})}))})).catch((function(){e.$message({showClose:!0,type:"info",message:"取消输入"})}))},handleRecover:function(t){var e=this,i=(t.userFlag,t.id),o=(t.projectId,t.topicName,{id:i});this.$confirm("确定要恢复该topic吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((function(){Object(s["k"])(o).then((function(t){0===t.code?(e.$message({showClose:!0,type:"success",message:t.msg}),e.getTopicList()):e.$message({showClose:!0,type:"error",message:t.msg})}))})).catch((function(){e.$message({showClose:!0,type:"info",message:"已取消恢复"})}))},resetForm:function(t){this.$refs[t].resetFields()}}},p=l,u=(i("3446"),i("2877")),m=Object(u["a"])(p,o,a,!1,null,null,null);e["default"]=m.exports},"6b5d":function(t,e,i){},7514:function(t,e,i){"use strict";var o=i("5ca1"),a=i("0a49")(5),s="find",c=!0;s in[]&&Array(1)[s]((function(){c=!1})),o(o.P+o.F*c,"Array",{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(s)},"77d2":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-dialog",{attrs:{title:t.title,visible:t.newPageVisible,"before-close":t.close,width:"75%"},on:{"update:visible":function(e){t.newPageVisible=e}}},[i("el-form",{ref:"topicSubmitForm",staticClass:"new-user-dialog",attrs:{model:t.topicParam,rules:t.topicSubmitRules,inline:!0,"label-width":"110px","label-position":"left"}},[i("el-row",[i("el-col",{attrs:{span:10}},[i("el-form-item",{attrs:{label:"所属项目：",prop:"projectId"}},[i("el-select",{attrs:{placeholder:"请输入所属项目"},model:{value:t.topicParam.projectId,callback:function(e){t.$set(t.topicParam,"projectId",e)},expression:"topicParam.projectId"}},t._l(t.userProjectSelects,(function(t,e){return i("el-option",{key:t+e,attrs:{label:t.projectCode,value:t.id}})})),1)],1)],1),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-form-item",{attrs:{label:"Topic名称：",prop:"topicName"}},[i("el-input",{attrs:{disabled:t.isDisabled,type:"text",maxlength:"50","show-word-limit":"",placeholder:"最大字符数不超过50个"},model:{value:t.topicParam.topicName,callback:function(e){t.$set(t.topicParam,"topicName",e)},expression:"topicParam.topicName"}}),t._v(" "),i("span",{staticClass:"prefix-tip"},[t._v("(注：格式必须以所选项目加 “_” 为前缀)")])],1)],1)],1),t._v(" "),i("el-row",[i("el-col",{attrs:{span:10}},[i("el-form-item",{attrs:{label:"分类标签：",prop:"topicFlag"}},[i("el-input",{attrs:{type:"text",maxlength:"50","show-word-limit":"",placeholder:"最大字符数不超过50个"},model:{value:t.topicParam.topicFlag,callback:function(e){t.$set(t.topicParam,"topicFlag",e)},expression:"topicParam.topicFlag"}})],1)],1),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-form-item",{attrs:{label:"Partition数量：",prop:"partitionNum"}},[i("el-input",{attrs:{disabled:t.partitionChecked},model:{value:t.topicParam.partitionNum,callback:function(e){t.$set(t.topicParam,"partitionNum",t._n(e))},expression:"topicParam.partitionNum"}}),t._v(" "),t.isDisabled?t._e():i("el-checkbox",{staticClass:"defaultChecked",model:{value:t.partitionChecked,callback:function(e){t.partitionChecked=e},expression:"partitionChecked"}},[t._v("默认")])],1)],1)],1),t._v(" "),i("el-form-item",{staticClass:"item_textarea",attrs:{label:"备注：",prop:"topicDesc"}},[i("el-input",{attrs:{autosize:{minRows:2,maxRows:5},type:"textarea",maxlength:"100",placeholder:"最大字符数不超过100"},model:{value:t.topicParam.topicDesc,callback:function(e){t.$set(t.topicParam,"topicDesc",e)},expression:"topicParam.topicDesc"}})],1)],1),t._v(" "),i("div",{staticClass:"btn_group"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("topicSubmitForm","save")}}},[t._v("保存")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("topicSubmitForm","submit")}}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:t.close}},[t._v("取消")])],1)],1)],1)},a=[],s=(i("7514"),i("abad")),c={name:"TopicDetail",props:{title:{type:String,default:""},newPageVisible:{type:Boolean,default:!1},currentRow:{type:Object,default:function(){}}},data:function(){var t=function(t,e,i){if(!e)return i(new Error("Topic名称是必填的"));var o=/^[\w|/-]+$/;setTimeout((function(){o.test(e)?i():i(new Error("Topic名称只包含字母，数字，下划线或中划线"))}),100)};return{topicParam:{id:null,partitionNum:1,projectId:null,topicDesc:"",topicFlag:"",topicName:"",topicStatus:""},topicSubmitRules:{partitionNum:[{required:!0,message:"Partition数量不能为空",trigger:"blur"},{type:"number",message:"Partition数量必须为数字值"}],projectId:[{required:!0,message:"所属项目是必填的",trigger:"change"}],topicName:[{required:!0,validator:t,trigger:"blur"}]},userProjectSelects:[],projectCode:"",partitionChecked:!0,isDisabled:!1}},created:function(){this.getProjectList()},methods:{setDefaultChecked:function(){this.partitionChecked=!0},getRowData:function(t){var e=t.id,i=t.partitionNum,o=t.projectId,a=t.topicDesc,s=t.topicFlag,c=t.topicName,n=t.topicStatus;this.topicParam={id:e,partitionNum:i,projectId:o,topicDesc:a,topicFlag:s,topicName:c,topicStatus:n},4===n?(this.isDisabled=!0,this.partitionChecked=!0):this.isDisabled=!1},getProjectList:function(){var t=this;Object(s["i"])().then((function(e){t.userProjectSelects=e.datas}))},topicProjectChange:function(t){var e=this.userProjectSelects.find((function(e){return e.id===t}));this.projectCode=e.projectCode},close:function(){this.$emit("close")},submitForm:function(t,e){var i=this;this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;i.topicProjectChange(i.topicParam.projectId);var o=i.projectCode+"_";0!==i.topicParam.topicName.indexOf(o)?i.$message({message:"Topic名称不符合规范，必须以项目名称加下划线作为前缀",type:"warning"}):(i.topicParam.topicStatus="save"===e?0:1,i.title&&(i.topicParam.id="新建Topic"===i.title?null:i.topicParam.id),"submit"===e?i.$confirm("Topic创建后需经过管理员审批通过方可使用，确定提交审批？","",{confirmButtonText:"确定",cancelButtonText:"取消",center:!0}).then((function(){i.saveOrUpdate(i.topicParam)})).catch((function(){i.$message({showClose:!0,type:"info",message:"已取消操作"})})):i.saveOrUpdate(i.topicParam))}))},saveOrUpdate:function(t){var e=this;Object(s["m"])(t).then((function(t){if(0===t.code){var i={isSubmit:!0};e.$emit("close",i),e.$notify({title:"Success",message:"新建Topic"===e.title?"Topic新建成功":"Topic修改成功",type:"success",duration:2e3})}else e.$message({showClose:!0,message:t.msg,type:"error"})}))}}},n=c,r=(i("27cb"),i("2877")),l=Object(r["a"])(n,o,a,!1,null,null,null);e["default"]=l.exports},cd1c:function(t,e,i){var o=i("e853");t.exports=function(t,e){return new(o(t))(e)}},e853:function(t,e,i){var o=i("d3f4"),a=i("1169"),s=i("2b4c")("species");t.exports=function(t){var e;return a(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!a(e.prototype)||(e=void 0),o(e)&&(e=e[s],null===e&&(e=void 0))),void 0===e?Array:e}}}]);